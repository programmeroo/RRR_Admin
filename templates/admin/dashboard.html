{% extends "admin/base.html" %}

{% block title %}Dashboard{% endblock %}
{% block page_title %}Dashboard Overview{% endblock %}

{% block content %}

<!-- Stats Overview -->
<div class="row g-4 mb-4 animate-fade-in">
  <!-- Listings Summary -->
  <div class="col-md-6">
    <div class="glass-card p-4">
      <div class="d-flex justify-content-between align-items-start mb-3">
        <div>
          <p class="text-muted mb-1 text-uppercase small fw-bold">Listings</p>
          <h2 class="mb-0 fw-bold">{{ ((stats.listings_summary.TOTAL or 0) - (stats.listings_summary.sold or 0)) }}</h2>
          <small class="text-success">Active (Total - Sold)</small>
        </div>
        <div class="rounded-circle bg-primary bg-opacity-10 p-2 text-primary">
          <i class="bi bi-house-fill fs-4"></i>
        </div>
      </div>
      <div class="row g-2 mt-2">
        {% for status, count in stats.listings_summary.items() %}
          {% if status != 'TOTAL' %}
            <div class="col-4 text-center">
              <small class="text-muted d-block">{{ status|replace('_', ' ')|title }}</small>
              <strong class="{% if status == 'sold' %}text-danger{% elif status == 'new' %}text-info{% elif status in ['quoted', 'dscr_quoted'] %}text-warning{% else %}text-success{% endif %}">{{ count }}</strong>
            </div>
          {% endif %}
        {% endfor %}
      </div>
    </div>
  </div>

  <!-- Contacts -->
  <div class="col-md-3">
    <div class="glass-card p-4">
      <div class="d-flex justify-content-between align-items-start mb-3">
        <div>
          <p class="text-muted mb-1 text-uppercase small fw-bold">Contacts</p>
          <h2 class="mb-0 fw-bold">{{ stats.contacts_subscribed + stats.contacts_unsubscribed }}</h2>
        </div>
        <div class="rounded-circle bg-success bg-opacity-10 p-2 text-success">
          <i class="bi bi-people-fill fs-4"></i>
        </div>
      </div>
      <div class="d-flex justify-content-between text-sm mt-2">
        <span class="text-success"><i class="bi bi-check-circle me-1"></i>{{ stats.contacts_subscribed }} Subscribed</span>
      </div>
      <div class="d-flex justify-content-between text-sm">
        <span class="text-danger"><i class="bi bi-x-circle me-1"></i>{{ stats.contacts_unsubscribed }} Unsubscribed</span>
      </div>
    </div>
  </div>

  <!-- Flyer Printers -->
  <div class="col-md-3">
    <div class="glass-card p-4">
      <div class="d-flex justify-content-between align-items-start mb-3">
        <div>
          <p class="text-muted mb-1 text-uppercase small fw-bold">Flyer Printers</p>
          <h2 class="mb-0 fw-bold">{{ stats.flyer_printers }}</h2>
        </div>
        <div class="rounded-circle bg-info bg-opacity-10 p-2 text-info">
          <i class="bi bi-printer-fill fs-4"></i>
        </div>
      </div>
      <div class="d-flex align-items-center text-info small">
        <i class="bi bi-person-check me-1"></i>
        <span>Unique users</span>
      </div>
    </div>
  </div>
</div>

<!-- Rates and Logs Row -->
<div class="row g-4 mb-4">
  <!-- Rates -->
  <div class="col-md-8">
    <div class="glass-card p-4">
      <div class="d-flex justify-content-between align-items-start mb-3">
        <div>
          <p class="text-muted mb-1 text-uppercase small fw-bold">Rates - Orange County (House)</p>
        </div>
        <div class="rounded-circle bg-warning bg-opacity-10 p-2 text-warning">
          <i class="bi bi-percent fs-4"></i>
        </div>
      </div>
      <div class="row g-2">
        <div class="col-md-3 col-6 text-center">
          <small class="text-muted d-block">Conv-20</small>
          <strong class="text-white">{{ stats.rates.conv_20 or 'N/A' }}</strong>
        </div>
        <div class="col-md-3 col-6 text-center">
          <small class="text-muted d-block">Conv-5</small>
          <strong class="text-white">{{ stats.rates.conv_5 or 'N/A' }}</strong>
        </div>
        <div class="col-md-3 col-6 text-center">
          <small class="text-muted d-block">High-Bal-20</small>
          <strong class="text-white">{{ stats.rates.high_bal_20 or 'N/A' }}</strong>
        </div>
        <div class="col-md-3 col-6 text-center">
          <small class="text-muted d-block">High-Bal-5</small>
          <strong class="text-white">{{ stats.rates.high_bal_5 or 'N/A' }}</strong>
        </div>
        <div class="col-md-4 col-4 text-center mt-2">
          <small class="text-muted d-block">FHA</small>
          <strong class="text-white">{{ stats.rates.fha or 'N/A' }}</strong>
        </div>
        <div class="col-md-4 col-4 text-center mt-2">
          <small class="text-muted d-block">VA</small>
          <strong class="text-white">{{ stats.rates.va or 'N/A' }}</strong>
        </div>
        <div class="col-md-4 col-4 text-center mt-2">
          <small class="text-muted d-block">Jumbo</small>
          <strong class="text-white">{{ stats.rates.jumbo or 'N/A' }}</strong>
        </div>
      </div>
    </div>
  </div>

  <!-- Logs -->
  <div class="col-md-4">
    <div class="glass-card p-4">
      <div class="d-flex justify-content-between align-items-start mb-3">
        <div>
          <p class="text-muted mb-1 text-uppercase small fw-bold">Logs</p>
          <h2 class="mb-0 fw-bold">{{ stats.api_logs + stats.web_logs }}</h2>
          <small class="text-muted">Total records</small>
        </div>
        <div class="rounded-circle bg-secondary bg-opacity-10 p-2 text-secondary">
          <i class="bi bi-server fs-4"></i>
        </div>
      </div>
      <div class="d-flex justify-content-between mt-3 pt-3 border-top border-secondary border-opacity-25">
        <span class="text-muted">API Logs</span>
        <strong class="text-white">{{ stats.api_logs }}</strong>
      </div>
      <div class="d-flex justify-content-between mt-2">
        <span class="text-muted">Web Logs</span>
        <strong class="text-white">{{ stats.web_logs }}</strong>
      </div>
    </div>
  </div>
</div>

<div class="row g-4">
  <!-- Quick Actions -->
  <div class="col-md-8">
    <div class="glass-panel p-4 h-100">
      <h5 class="mb-4 d-flex align-items-center gap-2">
        <i class="bi bi-lightning-charge-fill text-warning"></i> Quick Actions
      </h5>

      <div class="row g-3">
        <div class="col-md-6">
          <a href="{{ url_for('workflow.index') }}" class="glass-card p-3 d-flex align-items-center gap-3 text-decoration-none h-100">
            <div class="rounded bg-primary bg-opacity-20 p-3 text-primary">
              <i class="bi bi-diagram-3-fill fs-4"></i>
            </div>
            <div>
              <h6 class="mb-1 text-white">Workflows</h6>
              <p class="mb-0 text-muted small">Main & Weekly Reports</p>
            </div>
          </a>
        </div>

        <div class="col-md-6">
          <a href="{{ url_for('admin.listings') }}" class="glass-card p-3 d-flex align-items-center gap-3 text-decoration-none h-100">
            <div class="rounded bg-success bg-opacity-20 p-3 text-success">
              <i class="bi bi-house-gear-fill fs-4"></i>
            </div>
            <div>
              <h6 class="mb-1 text-white">Listings</h6>
              <p class="mb-0 text-muted small">View and manage properties</p>
            </div>
          </a>
        </div>

        <div class="col-md-6">
          <a href="{{ url_for('admin.daily_prices') }}" class="glass-card p-3 d-flex align-items-center gap-3 text-decoration-none h-100">
            <div class="rounded bg-warning bg-opacity-20 p-3 text-warning">
              <i class="bi bi-currency-dollar fs-4"></i>
            </div>
            <div>
              <h6 class="mb-1 text-white">Daily Prices</h6>
              <p class="mb-0 text-muted small">QM loan rates</p>
            </div>
          </a>
        </div>

        <div class="col-md-6">
          <a href="{{ url_for('admin.dscr_prices') }}" class="glass-card p-3 d-flex align-items-center gap-3 text-decoration-none h-100">
            <div class="rounded bg-info bg-opacity-20 p-3 text-info">
              <i class="bi bi-building fs-4"></i>
            </div>
            <div>
              <h6 class="mb-1 text-white">DSCR Prices</h6>
              <p class="mb-0 text-muted small">Investor loan rates</p>
            </div>
          </a>
        </div>

        <div class="col-md-6">
          <a href="{{ url_for('admin.visitor_activity') }}" class="glass-card p-3 d-flex align-items-center gap-3 text-decoration-none h-100">
            <div class="rounded bg-secondary bg-opacity-20 p-3 text-secondary">
              <i class="bi bi-graph-up-arrow fs-4"></i>
            </div>
            <div>
              <h6 class="mb-1 text-white">User Activity</h6>
              <p class="mb-0 text-muted small">Analytics & flyer prints</p>
            </div>
          </a>
        </div>

        <div class="col-md-6">
           <!-- API Switcher Form embedded as a card -->
           <form method="POST" action="{{ url_for('admin.switch_api') }}" class="h-100">
            <button type="submit" name="api_mode" value="{% if current_api_mode == 'local' %}remote{% else %}local{% endif %}"
                    class="glass-card p-3 d-flex align-items-center gap-3 text-decoration-none w-100 border-0 text-start">
              <div class="rounded bg-danger bg-opacity-20 p-3 text-danger">
                <i class="bi bi-arrow-repeat fs-4"></i>
              </div>
              <div>
                <h6 class="mb-1 text-white">Switch API</h6>
                <p class="mb-0 text-muted small">
                  Current: <span class="text-white fw-bold">{{ current_api_mode|upper }}</span>
                </p>
              </div>
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- System Status -->
  <div class="col-md-4">
    <div class="glass-panel p-4 h-100">
      <h5 class="mb-4 d-flex align-items-center gap-2">
        <i class="bi bi-hdd-network-fill text-info"></i> System Status
      </h5>
      
      <div class="d-flex flex-column gap-3">
        <div class="d-flex justify-content-between align-items-center border-bottom border-secondary border-opacity-25 pb-3">
          <span class="text-muted">API Connection</span>
          <span class="badge bg-success bg-opacity-20 text-success">Connected</span>
        </div>
        
        <div class="d-flex justify-content-between align-items-center border-bottom border-secondary border-opacity-25 pb-3">
          <span class="text-muted">Environment</span>
          <span class="text-white">{{ current_api_mode|title }}</span>
        </div>
        
        <div class="d-flex justify-content-between align-items-center border-bottom border-secondary border-opacity-25 pb-3">
          <span class="text-muted">Database</span>
          <span class="text-white">MySQL (via API)</span>
        </div>
        
        <div class="d-flex justify-content-between align-items-center">
          <span class="text-muted">Last Sync</span>
          <span class="text-white">Just now</span>
        </div>
      </div>
      
      <div class="mt-4 pt-3 border-top border-secondary border-opacity-25">
        <p class="text-muted small mb-2">Storage Usage</p>
        <div class="progress bg-secondary bg-opacity-25" style="height: 6px;">
          <div class="progress-bar bg-primary" role="progressbar" style="width: 45%"></div>
        </div>
      </div>
    </div>
  </div>
</div>

{% endblock %}
